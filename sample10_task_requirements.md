# Discord タスク管理Bot 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Discord タスク管理Bot (sample10_task.py)

### 1.2 目的
Discordサーバー内でチームメンバーがタスクを効率的に管理・共有できるボットシステムを構築する

### 1.3 スコープ
- リアクション👍でタスク作成（投稿内容→タスク登録）
- リアクション❤️でタスク一覧表示
- リアクション✅でタスク完了切り替え
- 直感的なリアクションベースUI

## 2. システム要件

### 2.1 対象環境
- **対象ギルドID**: `1394139562028306644`
- **Python**: 3.11+
- **Discord.py**: 2.3.2
- **データベース**: Supabase PostgreSQL
- **DB接続**: psycopg2-binary

### 2.2 権限要件
- **全ユーザー**: リアクションによるタスク作成・一覧表示・完了切り替え

## 3. 機能要件

### 3.1 リアクションベース機能

#### 3.1.1 タスク作成（👍リアクション）
- **トリガー**: 任意のメッセージに👍リアクション
- **動作**: 
  - メッセージ内容をタスクタイトルとして登録
  - タスクID（連番）を自動生成
  - 作成者情報を記録
- **出力**: 「タスク#{ID}を作成しました」の確認メッセージ

#### 3.1.2 タスク一覧表示（❤️リアクション）
- **トリガー**: 任意のメッセージに❤️リアクション
- **動作**: 
  - 現在の全タスク一覧を表示
  - **各タスクを個別のメッセージとして投稿**
  - 各タスクメッセージに✅リアクションを自動追加
- **出力**: タスクごとの個別メッセージ

#### 3.1.3 タスク完了切り替え（✅リアクション）
- **トリガー**: Botのタスクメッセージに✅リアクション
- **動作**: 
  - 該当タスクの完了/未完了を切り替え
  - メッセージのタイトル更新（「✅完了」「📝未完了」）
- **出力**: メッセージの更新


## 4. データ設計

### 4.1 PostgreSQL テーブル設計

#### タスクテーブル（最小構成）
```sql
CREATE TABLE IF NOT EXISTS tasks (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    completed BOOLEAN DEFAULT FALSE
);
```

**✅ 採用仕様**: 
- ✅リアクションでタスク完了切り替え
- メッセージ更新なし（新しい一覧を再投稿）
- 最小構成でシンプルに実装

### 4.2 データ構造（最小構成）
```python
Task {
  id: int (SERIAL PRIMARY KEY)
  title: string (元メッセージの内容)
  completed: boolean (デフォルト: false)
}
```

## 5. UI/UX設計

### 5.1 リアクションフロー
```
1. 👍リアクション → タスク作成
   "📝 タスク#123を作成しました: [元メッセージ内容]"

2. ❤️リアクション → タスク一覧表示
   個別メッセージ投稿:
   "📝 タスク#123: [タスク内容]" (未完了)
   "✅ タスク#123: [タスク内容]" (完了)
   
3. ✅リアクション → 完了切り替え
   メッセージ更新: 📝 ⇔ ✅
```

### 5.2 Embed デザイン
- **未完了タスク**: 📝 + 青色
- **完了タスク**: ✅ + 緑色
- **作成者情報**: フッターに表示

### 5.3 エラーハンドリング
- 無効なリアクションは無視
- Bot自身のリアクションは無視
- メッセージが見つからない場合の処理

## 6. 非機能要件

### 6.1 パフォーマンス
- コマンド応答時間: 3秒以内
- 大量タスク表示時のページネーション

### 6.2 セキュリティ
- 権限チェックの徹底
- 入力値のバリデーション

### 6.3 保守性
- コードの可読性
- 設定の外部化
- エラーログの充実

## 7. 実装方針

### 7.1 開発フェーズ
1. **Phase 1**: リアクションベース機能（👍作成・❤️一覧・✅完了切り替え）
2. **Phase 2**: エラーハンドリング・安定性向上

### 7.2 テスト方針
- リアクション機能の動作確認
- データベース連携の確認
- エラーケースの確認

---

**要件定義完了 - 実装準備完了** ✅